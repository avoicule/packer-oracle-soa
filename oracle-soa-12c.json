{
  "variables": {
    "base_vm_name": "oracle-linux-6",
    "harddisk_size": "50960",
    "vm_name": "oracle-soa_qs-12c",
    "oracle_user": "oraclefmw",
    "java_rpm": "jdk-7u80-linux-x64.rpm",
    "java_home": "/usr/java/jdk1.7.0_80",
    "soa_zip": "fmw_12.1.3.0.0_soaqs_Disk1_1of1.zip",
    "soa_pkg": "fmw_12.1.3.0.0_soa_quickstart.jar",
    "soa_pkg2": "fmw_12.1.3.0.0_soa_quickstart2.jar",
    "atlas_token": "Wxup5lmGRBiw5w.atlasv1.acP4mLQyOWMR1wxucw9bxcz1r4pSlpuVGqTAVWyvLoPJXpBkaIAJN1Tfey9z5maMryE"
  },
  "builders": [{
    "type": "docker",
    "image": "oraclelinux:6.7",
    "commit": "true"
  },{
    "type": "virtualbox-ovf",
    "vm_name": "{{user `vm_name`}}",
    "output_directory": "build/{{user `vm_name`}}",
    "source_path": "build/{{user `base_vm_name`}}/{{user `base_vm_name`}}.ovf",

    "ssh_username": "vagrant",
    "ssh_password": "vagrant",
    "ssh_port": 22,
    "ssh_wait_timeout": "10000s",

    "headless": false,
    "boot_wait": "12s",

    "shutdown_command": "echo 'vagrant'|sudo -S /sbin/halt -h -p"
  }],
  "provisioners": [{
      "type": "file",
      "source": "./installers/oracle-java/{{user `java_rpm`}}",
      "destination": "/tmp/{{user `java_rpm`}}"
  }, {
    "type": "shell",
    "scripts": [
      "scripts/oracle-java/install-jdk-rpm.sh"
    ],
    "environment_vars": [
      "JAVA_RPM=/tmp/{{user `java_rpm`}}",
      "JAVA_HOME={{user `java_home`}}"
    ],
    "override": {
      "virtualbox-ovf": {
        "execute_command": "echo 'vagrant' | {{.Vars}} sudo -S -E bash '{{.Path}}'"
      }
    }
  }, {
    "type": "shell",
    "scripts": [
      "scripts/oracle-fmw/create-oracle-user.sh"
    ],
    "environment_vars": [
      "OS_GROUP=oinstall",
      "OS_USER={{user `oracle_user`}}"
    ],
    "override": {
      "virtualbox-ovf": {
        "execute_command": "echo 'vagrant' | {{.Vars}} sudo -S -E bash '{{.Path}}'"
      }
    }
  }, {
      "type": "file",
      "source": "./installers/oracle-fmw/{{user `soa_zip`}}",
      "destination": "/tmp/{{user `soa_zip`}}"
  }, {
    "type": "shell",
    "scripts": [
      "scripts/oracle-fmw/install-soa_qs-12c.sh"
    ],
    "environment_vars": [
      "JAVA_HOME={{user `java_home`}}",
      "OS_GROUP=oinstall",
      "OS_USER={{user `oracle_user`}}",
      "SOA_ZIP=/tmp/{{user `soa_zip`}}",
      "SOA_PKG={{user `soa_pkg`}}",
      "SOA_PKG2={{user `soa_pkg2`}}",
      "ORACLE_HOME=/home/{{user `oracle_user`}}/product/Oracle_Home"
    ],
    "override": {
      "virtualbox-ovf": {
        "execute_command": "echo 'vagrant' | {{.Vars}} sudo -S -E bash '{{.Path}}'"
      }
    }
  }, {
    "type": "shell",
    "scripts": [
      "scripts/common/minimize.sh"
    ],
    "override": {
      "virtualbox-ovf": {
        "execute_command": "echo 'vagrant' | {{.Vars}} sudo -S -E bash '{{.Path}}'"
      }
    }
  }],
  "post-processors": [
    [
      {
        "type": "docker-tag",
        "only": ["docker"],
        "repository": "jeqo/oracle-soa-12c",
        "tag": "12.1.3-dev"
      }
    ], [{
      "type": "vagrant",
      "only": ["virtualbox-ovf"],
      "output": "build/{{user `vm_name`}}/{{user `vm_name`}}.box",
      "compression_level": 9,
      "keep_input_artifact": true
    }]
  ]
}
